<h2>Overview <small><span class="label label-info">Namespace</span> <span class="inlinecode">graph</span></small></h2>

<ul class="thumbnails">
  <li class="span4">
    <p>
    Collins has an easy to implement plugin for graph and trending systems. The
    graph plugin will display embedded graphs or charts for assets, or just links to
    those systems (depending on the graph plugin). Once enabled, you will find an additional
    tab on the asset details screen named 'Graphs' with all the configured information
    available in it.
    </p>

    <p>
    There is currently only support for Fibr, the <a href="http://opentsdb.net/">OpenTSDB</a>
    visualization tool we built at Tumblr. While there are plans to open source fibr in the
    near future, it is likely an early November release.
    </p>

    <p>
    Because graph plugins are easy to implement, we hope that the community will
    contribute plugins for other common similar systems such as graphite, munin, or
    ganglia.
    </p>

    <p>
    If you are interested in building and contributing a plugin and have any questions, please
    feel free to reach out on the mailing list.
    </p>
  </li>
  <li class="span5">
    <a href="img/asset_graph.png" class="thumbnail" target="_blank"><img src="img/asset_graph.png" alt="Asset trending"></a>
  </li>
</ul>

<table class="table table-condensed table-hover">
  <thead>
    <tr>
      <th>Key</th><th>Type</th><th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="inlinecode">class</td>
      <td>String</td>
      <td>Class that implements the neccesary graph plugin. Defaults to <code>collins.graphs.FibrGraphs</code></td>
    </tr>
    <tr>
      <td class="inlinecode">enabled</td>
      <td>Boolean</td>
      <td>Defaults to false.</td>
    </tr>
    <tr>
      <td class="inlinecode">queryCacheSize</td>
      <td>Integer</td>
      <td>Defaults to 2000. This is the size cache to keep for custom metrics. Custom metrics are metrics to include for a host dynamically, based on a search query. This allows you to say things like "Memcache hosts should also display these metrics".</td>
    </tr>
    <tr>
      <td class="inlinecode">queryCacheTimeout</td>
      <td>Duration</td>
      <td>Defaults to 60 seconds. The amount of time to wait before expiring a query from the cache.</td>
    </tr>
  </tbody>
</table>

<div class="example reference-config">
<pre>graph {
  class = "collins.graphs.FibrGraphs"
  enabled = false
  queryCacheSize = 2000
  queryCacheTimeout = 60 seconds

  FibrGraphs {
    annotations = [deploy]
    customMetrics = {}
    defaultMetrics = [
      SYS/LOAD,
      SYS/MEM,
      SYS/NET,
      SYS/PROC,
      SYS/IO-UTIL
    ]
    timeframe = 1 hour
    url = "http://fibr.d2.tumblr.net"
}</pre>
</div>

<h3>Fibr Graphs <small><span class="label label-info">Namespace</span> <span class="inlinecode">graph.FibrGraphs</span></small></h3>

<p>
At Tumblr, Fibr is our primary trending, graphing, and systems visualization tool. There is more information
on <a href="tools.html#fibr">fibr</a> in the tool document.
</p>

<table class="table table-condensed table-hover">
  <thead>
    <tr>
      <th>Key</th><th>Type</th><th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="inlinecode">annotations</td>
      <td>Set[String]</td>
      <td>Annotations to display with graphs. Defaults to <code>[deploy]</code> (show deploy lines)</td>
    </tr>
    <tr>
      <td class="inlinecode">customMetrics</td>
      <td>Object</td>
      <td>Metrics to display based on asset information</td>
    </tr>
    <tr>
      <td class="inlinecode">defaultMetrics</td>
      <td>Set[String]</td>
      <td>Metrics to display for any asset. Defaults to <code>SYS/LOAD, SYS/MEM, SYS/NET, SYS/PROC, SYS/IO-UTIL</code></td>
    </tr>
    <tr>
      <td class="inlinecode">timeframe</td>
      <td>Duration</td>
      <td>What timeframe to display for the metrics. Defaults to 1 hour (shows 1 hour of data).</td>
    </tr>
    <tr>
      <td class="inlinecode">url</td>
      <td>URL</td>
      <td>
        The Fibr web URL. Defaults to <code>http://fibr.d2.tumblr.net/</code> which is almost certainly
        not suitable outside of Tumblr.
      </td>
    </tr>
  </tbody>
</table>

<div class="example example-config">
<pre>graph.FibrGraphs {
  customMetrics = {
    mysqlHosts {
      selector = "PRIMARY_ROLE = \"DATABASE\""
      metrics = [
        MYSQL/COMMANDS,
        MYSQL/SLOW,
        MYSQL/THREADS,
        MYSQL/NET
      ]
    }
    memcacheHosts {
      selector = "POOL = MEMCACHE*"
      metrics = [
        MEMCACHE/COMMANDS,
        MEMCACHE/EVICTS,
        MEMCACHE/ITEMS,
        MEMCACHE/HITRATIO
      ]
    }
  }
}</pre>
</div>

<p>
In the above example, hosts that have a <code>PRIMARY_ROLE</code> of <code>DATABASE</code> will
display in addition to the default metrics, the MySQL specific metrics. Assets with a <code>POOL</code>
matching <code>MEMCACHE*</code> will additionally display memcache specific metrics.
</p>
